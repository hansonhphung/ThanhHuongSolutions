@using ThanhHuongSolution.Models.Selling;
@model SellingInformationModel

@{
    ViewBag.Title = "Xuất Hàng";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<header class="page-header">
    <h2>Xuất Hóa Đơn</h2>
</header>

<!-- start: page -->
<div class="row" ng-app="ThanhHuongSolution" ng-controller="SellingController">
    <div class="col-md-12" ng-init="init(@Json.Encode(Model))">
        <section class="panel">
            <div class="panel-body">

                <div class="row">
                    <div class="col-md-6 col-md-6">
                        <label class="col-sm-4 control-label">Khách Hàng <span class="required">*</span></label>
                        <div class="col-sm-8">

                            <ui-select ng-model ="selectedCustomer" theme="bootstrap" on-select="selectCustomer(selectedCustomer)">

                                <ui-select-match placeholder="Chọn khách hàng...">
                                    {{selectedCustomer.CustomerName | limitTo:25}} {{selectedCustomer.CustomerName.length < 25 ? '' : '...'}}
                                </ui-select-match>

                                <ui-select-choices repeat="customer in lstCustomer | filter: $select.search">
                                    {{customer.CustomerName}}
                                </ui-select-choices>
                            </ui-select>
                        </div>
                    </div>
                    <div class="col-md-6 col-md-6">
                        <label class="col-sm-4 control-label">Ngày Lập <span class="required">*</span></label>
                        <div class="col-sm-8">
                            <div class="input-group">
                                <span class="input-group-addon">
                                    <i class="fa fa-calendar"></i>
                                </span>
                                <input class="form-control" ng-disabled="true" ng-model ="createBillDate">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <section class="panel-body">
                        <div class="col-md-4 col-xs-4">
                            <header class="panel-heading">
                                <h2 class="panel-title">Thêm Hàng</h2>
                            </header>
                            <div class="panel-body">
                                <div class="form-group">
                                    <label class="col-sm-4 control-label">Mặt Hàng <span class="required">*</span></label>
                                    <div class="col-sm-8">
                                        <ui-select ng-model="selectedProduct" theme="bootstrap" on-select="selectProduct(selectedProduct)">

                                            <ui-select-match placeholder="Chọn mặt hàng...">
                                                {{selectedProduct.Name | limitTo:20}} {{selectedProduct.Name.length < 20 ? '' : '...'}}
                                            </ui-select-match>

                                            <ui-select-choices repeat="product in lstProduct | filter: $select.search">
                                                {{product.Name}}
                                            </ui-select-choices>
                                        </ui-select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-4 control-label">Giá Bán Sỉ <span class="required">*</span></label>
                                    <div class="col-sm-8">
                                        <input type="number" class="form-control" ng-model="wholesalePrice" ng-disabled="true" />
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-4 control-label">Giá Bán Lẻ <span class="required">*</span></label>
                                    <div class="col-sm-8">
                                        <input type="number" class="form-control" ng-model="retailPrice" ng-disabled="true"/>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-4 control-label">Số Lượng <span class="required">*</span></label>
                                    <div class="col-sm-8">
                                        <input type="number" class="form-control" ng-model="number" required min="1" />
                                    </div>
                                </div>


                                <div class="form-group">
                                    <div class="col-md-12 center">
                                        <button class="btn btn-success" ng-click="addProductItem()">Thêm</button>
                                        <button type="reset" class="btn btn-default">Hủy Bỏ</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-8 col-xs-8">
                            <header class="panel-heading">
                                <h2 class="panel-title">Danh Sách Hàng Đã Chọn</h2>
                            </header>
                            <div class="panel-body">
                                <table class="table table-responsive table-striped">
                                    <thead>
                                        <tr>
                                            <th>Mã SP</th>
                                            <th>Tên SP</th>
                                            <th>Số Lượng</th>
                                            <th>Thành Tiền</th>
                                            <th class="hidden-phone"></th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr class="gradeX" ng-repeat="item in shoppingCart">
                                            <td>{{item.TrackingNumber}}</td>
                                            <td>{{item.Name}}</td>
                                            <td>{{item.Number}}</td>
                                            <td>{{item.TotalPrice}}</td>
                                            <td class="hidden-phone">
                                                <button type="button" class="btn btn-default" data-toggle="modal" data-target="#detailCustomerFormModal" ng-click="viewCustomer(customer.Id)"><i class="fa fa-edit"></i></button>
                                                <button type="button" class="btn btn-danger" ng-click="deleteItemInCart(item.TrackingNumber)"><i class="fa fa-trash-o"></i></button>
                                            </td>
                                        </tr>
                                        
                                    </tbody>
                                </table>
                            </div>
                            <div style="text-align:center">
                                <div class="table-pagination">
                                    <uib-pagination boundary-links="true" total-items="totalProduct" ng-model="pageIndex" max-size="maxSize" class="pagination" rotate="false" items-per-page="recordPerPage" ng-change="onChangePageIndex()" previous-text="&lsaquo;" next-text="&rsaquo;" first-text="&laquo;" last-text="&raquo;"></uib-pagination>
                                </div>
                            </div>
                        </div>
                    </section>

                </div>

                <div class="row">
                    <div class="col-md-4 col-xs-4 center">
                        <button type="button" class="mb-xs mt-xs mr-xs btn btn-lg btn-success" ng-click="createBilling()">Tạo Hóa Đơn</button>
                        <button type="button" class="mb-xs mt-xs mr-xs btn btn-lg btn-default">In</button>
                        <button type="button" class="mb-xs mt-xs mr-xs btn btn-lg btn-warning" ng-click="cancel()">Làm lại</button>
                    </div>
                    <div class="col-md-4 col-xs-4 col-md-offset-4 text-left">
                        <div class="m-none">
                            <span><h3>Thành Tiền : {{totalAmount}} VND</h3></span>
                        </div>
                        <div class="m-none">
                            <div class="col-sm-4"> <h3>Tiền khách trả: </h3></div>
                            <div class="col-sm-8"> <input type="number" class="form-control" ng-model="payAmount" min="0" ng-keyup="numberInputTypeKeyPress($event)"/></div>
                        </div>
                        
                        <div class="m-none">
                            <span><h3>Còn nợ : {{liabilityAmount}} VND<h2></span>
                        </div>
                    </div>
                </div>
                @Html.Partial("_DetailSelling")
            </div>
        </section>
    </div>
</div>

<script src="/Vendor/angular/angular.min.js"></script>
<script src="~/Scripts/Selling/SellingController.js"></script>